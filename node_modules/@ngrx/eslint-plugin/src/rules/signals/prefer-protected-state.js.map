{"version":3,"file":"prefer-protected-state.js","sourceRoot":"","sources":["../../../../../../modules/eslint-plugin/src/rules/signals/prefer-protected-state.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,2CAA6B;AAC7B,qDAAgD;AAEnC,QAAA,oBAAoB,GAAG,sBAAsB,CAAC;AAC9C,QAAA,2BAA2B,GAAG,6BAA6B,CAAC;AAOzE,kBAAe,IAAA,yBAAU,EAAsB;IAC7C,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI;IACjC,IAAI,EAAE;QACJ,IAAI,EAAE,YAAY;QAClB,cAAc,EAAE,IAAI;QACpB,IAAI,EAAE;YACJ,WAAW,EAAE,wCAAwC;YACrD,UAAU,EAAE,SAAS;SACtB;QACD,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE;YACR,CAAC,4BAAoB,CAAC,EACpB,kFAAkF;YACpF,CAAC,mCAA2B,CAAC,EAAE,mCAAmC;SACnE;KACF;IACD,cAAc,EAAE,EAAE;IAClB,MAAM,EAAE,CAAC,OAAO,EAAE,EAAE;QAClB,OAAO;YACL,CAAC,4JAA4J,CAAC,CAC5J,IAAuB;gBAEvB,OAAO,CAAC,MAAM,CAAC;oBACb,IAAI;oBACJ,SAAS,EAAE,4BAAoB;oBAC/B,OAAO,EAAE;wBACP;4BACE,SAAS,EAAE,mCAA2B;4BACtC,GAAG,EAAE,CAAC,KAAK,EAAE,EAAE;gCACb,MAAM,mBAAmB,GAAG,GAEvB,EAAE;oCACL,MAAM,YAAY,GAAG,IAAI,CAAC,MAAmC,CAAC;oCAC9D,MAAM,8BAA8B,GAClC,YAAY,CAAC,UAAU,CAAC,MAAM,KAAK,CAAC,CAAC;oCAEvC,IAAI,8BAA8B,EAAE,CAAC;wCACnC;;2CAEG;wCACH,OAAO,YAAY,CAAC,KAAK,CAAC;oCAC5B,CAAC;oCAED,MAAM,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;oCAC1D,MAAM,iBAAiB,GAAG,UAAU,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,GAAG,CAAC;oCAC5D;;uCAEG;oCACH,OAAO;wCACL,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;wCACb;;2CAEG;wCACH,iBAAiB,CAAC,CAAC,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;qCACxD,CAAC;gCACJ,CAAC,CAAC;gCAEF,OAAO,KAAK,CAAC,WAAW,CAAC,mBAAmB,EAAE,CAAC,CAAC;4BAClD,CAAC;yBACF;qBACF;iBACF,CAAC,CAAC;YACL,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC,CAAC","sourcesContent":["import { type TSESTree } from '@typescript-eslint/utils';\nimport * as path from 'path';\nimport { createRule } from '../../rule-creator';\n\nexport const preferProtectedState = 'preferProtectedState';\nexport const preferProtectedStateSuggest = 'preferProtectedStateSuggest';\n\ntype MessageIds =\n  | typeof preferProtectedState\n  | typeof preferProtectedStateSuggest;\ntype Options = readonly [];\n\nexport default createRule<Options, MessageIds>({\n  name: path.parse(__filename).name,\n  meta: {\n    type: 'suggestion',\n    hasSuggestions: true,\n    docs: {\n      description: `A Signal Store prefers protected state`,\n      ngrxModule: 'signals',\n    },\n    schema: [],\n    messages: {\n      [preferProtectedState]:\n        '{ protectedState: false } should be removed to prevent external state mutations.',\n      [preferProtectedStateSuggest]: 'Remove `{protectedState: false}`.',\n    },\n  },\n  defaultOptions: [],\n  create: (context) => {\n    return {\n      [`CallExpression[callee.name=signalStore][arguments.length>0] > ObjectExpression[properties.length>0] > Property[key.name=protectedState][value.value=false]`](\n        node: TSESTree.Property\n      ) {\n        context.report({\n          node,\n          messageId: preferProtectedState,\n          suggest: [\n            {\n              messageId: preferProtectedStateSuggest,\n              fix: (fixer) => {\n                const getRangeToBeRemoved = (): Parameters<\n                  typeof fixer.removeRange\n                >[0] => {\n                  const parentObject = node.parent as TSESTree.ObjectExpression;\n                  const parentObjectHasOnlyOneProperty =\n                    parentObject.properties.length === 1;\n\n                  if (parentObjectHasOnlyOneProperty) {\n                    /**\n                     * Remove the entire object if it contains only one property - the relevant one\n                     */\n                    return parentObject.range;\n                  }\n\n                  const tokenAfter = context.sourceCode.getTokenAfter(node);\n                  const tokenAfterIsComma = tokenAfter?.value?.trim() === ',';\n                  /**\n                   * Remove the specific property if there is more than one property in the parent\n                   */\n                  return [\n                    node.range[0],\n                    /**\n                     *  remove trailing comma as well\n                     */\n                    tokenAfterIsComma ? tokenAfter.range[1] : node.range[1],\n                  ];\n                };\n\n                return fixer.removeRange(getRangeToBeRemoved());\n              },\n            },\n          ],\n        });\n      },\n    };\n  },\n});\n"]}