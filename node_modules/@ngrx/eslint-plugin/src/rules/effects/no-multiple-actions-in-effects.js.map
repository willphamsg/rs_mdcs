{"version":3,"file":"no-multiple-actions-in-effects.js","sourceRoot":"","sources":["../../../../../../modules/eslint-plugin/src/rules/effects/no-multiple-actions-in-effects.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,oDAIkC;AAClC,2CAA6B;AAC7B,qDAAgD;AAChD,uCAKqB;AAER,QAAA,SAAS,GAAG,4BAA4B,CAAC;AAUtD,kBAAe,IAAA,yBAAU,EAAsB;IAC7C,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI;IACjC,IAAI,EAAE;QACJ,IAAI,EAAE,SAAS;QACf,IAAI,EAAE;YACJ,WAAW,EAAE,8CAA8C;YAC3D,UAAU,EAAE,SAAS;YACrB,oBAAoB,EAAE,IAAI;SAC3B;QACD,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE;YACR,CAAC,iBAAS,CAAC,EAAE,yCAAyC;SACvD;KACF;IACD,cAAc,EAAE,EAAE;IAClB,MAAM,EAAE,CAAC,OAAO,EAAE,EAAE;QAClB,OAAO;YACL,CAAC,GAAG,8BAAsB,IAAI,sCAA8B,EAAE,CAAC,CAC7D,IAAmC;gBAEnC,MAAM,YAAY,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC;gBAC3C,IAAI,CAAC,YAAY,EAAE,CAAC;oBAClB,OAAO;gBACT,CAAC;gBAED,MAAM,QAAQ,GAAG,mBAAW,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;gBACxD,MAAM,WAAW,GAAG,QAAQ,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;gBACtD,MAAM,IAAI,GAAG,QAAQ,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;gBAEtD,IAAI,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC;oBAClC,OAAO,CAAC,MAAM,CAAC;wBACb,IAAI,EAAE,YAAY;wBAClB,SAAS,EAAT,iBAAS;qBACV,CAAC,CAAC;gBACL,CAAC;qBAAM,IACL,IAAI,CAAC,OAAO,EAAE;oBACd,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,EACpD,CAAC;oBACD,OAAO,CAAC,MAAM,CAAC;wBACb,IAAI,EAAE,YAAY;wBAClB,SAAS,EAAT,iBAAS;qBACV,CAAC,CAAC;gBACL,CAAC;YACH,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC,CAAC;AAEH,SAAS,eAAe,CAAC,IAAmC;IAC1D,QAAQ,IAAI,CAAC,IAAI,EAAE,CAAC;QAClB,KAAK,sBAAc,CAAC,uBAAuB,CAAC;QAC5C,KAAK,sBAAc,CAAC,kBAAkB;YACpC,OAAO,IAAA,wBAAgB,EAAC,IAAI,CAAC,IAAI,CAAC;gBAChC,CAAC,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;gBACrC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;QAChB,KAAK,sBAAc,CAAC,cAAc;YAChC,OAAO,mBAAmB,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QAClE;YACE,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;AACH,CAAC;AAED,SAAS,mBAAmB,CAAC,KAAsB;IACjD,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAiC,EAAE,CACjE,IAAA,yBAAiB,EAAC,CAAC,CAAC,CACrB,CAAC;IACF,OAAO,UAAU,EAAE,QAAQ,CAAC;AAC9B,CAAC","sourcesContent":["import {\n  AST_NODE_TYPES,\n  ESLintUtils,\n  type TSESTree,\n} from '@typescript-eslint/utils';\nimport * as path from 'path';\nimport { createRule } from '../../rule-creator';\nimport {\n  createEffectExpression,\n  isBlockStatement,\n  isReturnStatement,\n  mapLikeOperatorCallExpressions,\n} from '../../utils';\n\nexport const messageId = 'noMultipleActionsInEffects';\n\ntype MessageIds = typeof messageId;\ntype Options = readonly unknown[];\ntype EffectsMapLikeOperatorsReturn =\n  | TSESTree.ArrowFunctionExpression\n  | TSESTree.CallExpression\n  | TSESTree.FunctionExpression\n  | TSESTree.ReturnStatement;\n\nexport default createRule<Options, MessageIds>({\n  name: path.parse(__filename).name,\n  meta: {\n    type: 'problem',\n    docs: {\n      description: '`Effect` should not return multiple actions.',\n      ngrxModule: 'effects',\n      requiresTypeChecking: true,\n    },\n    schema: [],\n    messages: {\n      [messageId]: '`Effect` should return a single action.',\n    },\n  },\n  defaultOptions: [],\n  create: (context) => {\n    return {\n      [`${createEffectExpression} ${mapLikeOperatorCallExpressions}`](\n        node: EffectsMapLikeOperatorsReturn\n      ) {\n        const nodeToReport = getNodeToReport(node);\n        if (!nodeToReport) {\n          return;\n        }\n\n        const services = ESLintUtils.getParserServices(context);\n        const typeChecker = services.program.getTypeChecker();\n        const type = services.getTypeAtLocation(nodeToReport);\n\n        if (typeChecker.isArrayType(type)) {\n          context.report({\n            node: nodeToReport,\n            messageId,\n          });\n        } else if (\n          type.isUnion() &&\n          type.types.some((ut) => typeChecker.isArrayType(ut))\n        ) {\n          context.report({\n            node: nodeToReport,\n            messageId,\n          });\n        }\n      },\n    };\n  },\n});\n\nfunction getNodeToReport(node: EffectsMapLikeOperatorsReturn) {\n  switch (node.type) {\n    case AST_NODE_TYPES.ArrowFunctionExpression:\n    case AST_NODE_TYPES.FunctionExpression:\n      return isBlockStatement(node.body)\n        ? findReturnStatement(node.body.body)\n        : node.body;\n    case AST_NODE_TYPES.CallExpression:\n      return findReturnStatement(node.arguments) ?? node.arguments[0];\n    default:\n      return node.argument;\n  }\n}\n\nfunction findReturnStatement(nodes: TSESTree.Node[]) {\n  const returnNode = nodes.find((n): n is TSESTree.ReturnStatement =>\n    isReturnStatement(n)\n  );\n  return returnNode?.argument;\n}\n"]}