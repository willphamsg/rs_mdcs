{"version":3,"file":"prefix-selectors-with-select.js","sourceRoot":"","sources":["../../../../../../modules/eslint-plugin/src/rules/store/prefix-selectors-with-select.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,2CAA6B;AAC7B,qDAAgD;AAChD,uCAAyC;AAE5B,QAAA,yBAAyB,GAAG,2BAA2B,CAAC;AACxD,QAAA,gCAAgC,GAC3C,kCAAkC,CAAC;AAOrC,kBAAe,IAAA,yBAAU,EAAsB;IAC7C,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI;IACjC,IAAI,EAAE;QACJ,IAAI,EAAE,YAAY;QAClB,cAAc,EAAE,IAAI;QACpB,IAAI,EAAE;YACJ,WAAW,EACT,sEAAsE;YACxE,UAAU,EAAE,OAAO;SACpB;QACD,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE;YACR,CAAC,iCAAyB,CAAC,EAAE,0CAA0C;YACvE,CAAC,wCAAgC,CAAC,EAChC,kDAAkD;SACrD;KACF;IACD,cAAc,EAAE,EAAE;IAClB,MAAM,EAAE,CAAC,OAAO,EAAE,EAAE;QAClB,SAAS,eAAe,CAAC,IAAY,EAAE,IAAyB;YAC9D,8BAA8B;YAC9B,yEAAyE;YACzE,MAAM,OAAO,GACX,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;gBACzB,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM;gBAC7B,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;YAE/C,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,MAAM,aAAa,GAAG,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAC7C,OAAO,CAAC,MAAM,CAAC;oBACb,IAAI;oBACJ,GAAG,EAAE;wBACH,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK;wBACrB,GAAG,EAAE;4BACH,IAAI,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI;4BACzB,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM;yBAC5C;qBACF;oBACD,SAAS,EAAE,iCAAyB;oBACpC,OAAO,EAAE;wBACP;4BACE,SAAS,EAAE,wCAAgC;4BAC3C,IAAI,EAAE,EAAE,IAAI,EAAE,aAAa,EAAE;4BAC7B,GAAG,EAAE,CAAC,KAAK,EAAE,EAAE;gCACb,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;gCAC3B,MAAM,UAAU,GAAG,OAAO,CAAC,aAAa,EAAE,CAAC;gCAE3C,gDAAgD;gCAChD,IACE,MAAM;oCACN,MAAM,CAAC,IAAI,KAAK,UAAU;oCAC1B,MAAM,CAAC,KAAK,KAAK,IAAI;oCACrB,MAAM,CAAC,MAAM;oCACb,MAAM,CAAC,MAAM,CAAC,IAAI,KAAK,eAAe,EACtC,CAAC;oCACD,OAAO,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;gCAChD,CAAC;gCAED,0DAA0D;gCAC1D,IACE,MAAM;oCACN,MAAM,CAAC,IAAI,KAAK,oBAAoB;oCACpC,MAAM,CAAC,EAAE,CAAC,IAAI,KAAK,YAAY,EAC/B,CAAC;oCACD,MAAM,cAAc,GAAG,MAAM,CAAC,EAAE,CAAC,cAAc;wCAC7C,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,cAAc,CAAC;wCAC9C,CAAC,CAAC,EAAE,CAAC;oCACP,OAAO,KAAK,CAAC,WAAW,CACtB,MAAM,CAAC,EAAE,EACT,GAAG,aAAa,GAAG,cAAc,EAAE,CACpC,CAAC;gCACJ,CAAC;gCAED,wCAAwC;gCACxC,OAAO,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;4BAChD,CAAC;yBACF;qBACF;iBACF,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAED,SAAS,qBAAqB,CAAC,IAA6B;YAC1D,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;YAC3B,OAAO,CACL,MAAM,CAAC,IAAI,KAAK,YAAY;gBAC5B;oBACE,gBAAgB;oBAChB,uBAAuB;oBACvB,uBAAuB;iBACxB,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CACxB,CAAC;QACJ,CAAC;QAED,SAAS,iBAAiB,CACxB,IAAY,EACZ,IAAyB,EACzB,IAAmD;YAEnD,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,IAAI,qBAAqB,CAAC,IAAI,CAAC,EAAE,CAAC;gBAClE,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC9B,CAAC;YAED,IAAI,IAAI,CAAC,IAAI,KAAK,gBAAgB,EAAE,CAAC;gBACnC,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;oBAC7B,IACE,IAAI,CAAC,IAAI,KAAK,iBAAiB;wBAC/B,IAAI,CAAC,QAAQ;wBACb,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,gBAAgB;wBACvC,qBAAqB,CAAC,IAAI,CAAC,QAAQ,CAAC,EACpC,CAAC;wBACD,eAAe,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;oBAC9B,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC;QAED,OAAO;YACL,kBAAkB,CAAC,IAAiC;gBAClD,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;gBAE1B,MAAM,gBAAgB,GACpB,IAAI,EAAE,IAAI,KAAK,gBAAgB;oBAC/B,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,YAAY;wBACjC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,cAAc,CAAC;wBACpC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,kBAAkB;4BACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,YAAY;4BAC1C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,cAAc,CAAC,CAAC,CAAC;gBAErD,IAAI,EAAE,CAAC,IAAI,KAAK,eAAe,IAAI,gBAAgB,EAAE,CAAC;oBACpD,KAAK,MAAM,IAAI,IAAI,EAAE,CAAC,UAAU,EAAE,CAAC;wBACjC,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;4BACjE,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;wBAC/C,CAAC;oBACH,CAAC;oBACD,OAAO;gBACT,CAAC;gBAED,IAAI,EAAE,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;oBAC7B,MAAM,QAAQ,GACZ,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,IAAI,KAAK,iBAAiB;wBACjE,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,KAAK,YAAY;wBAClE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI;wBACrD,CAAC,CAAC,IAAI,CAAC;oBAEX,MAAM,eAAe,GACnB,QAAQ,KAAK,IAAI,IAAI,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;oBAElD,MAAM,cAAc,GAClB,IAAI,EAAE,IAAI,KAAK,gBAAgB,IAAI,qBAAqB,CAAC,IAAI,CAAC,CAAC;oBAEjE,MAAM,eAAe,GACnB,IAAI,EAAE,IAAI,KAAK,yBAAyB;wBACxC,IAAI,CAAC,IAAI;wBACT,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB;4BAClC,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC,CAAC;oBAEzC,MAAM,oBAAoB,GACxB,IAAI,EAAE,IAAI,KAAK,oBAAoB;wBACnC,IAAI,CAAC,IAAI;wBACT,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC;oBAEtC,IAAI,eAAe,IAAI,cAAc,EAAE,CAAC;wBACtC,eAAe,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;oBAC/B,CAAC;yBAAM,IAAI,eAAe,IAAI,oBAAoB,EAAE,CAAC;wBACnD,iBAAiB,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC5C,CAAC;gBACH,CAAC;YACH,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC,CAAC;AAEH,SAAS,gBAAgB,CAAC,IAAY;IACpC,MAAM,UAAU,GAAG,QAAQ,CAAC;IAE5B,IAAI,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,CAAC;QAChC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAC3C,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACtB,OAAO,cAAc,CAAC;QACxB,CAAC;QACD,IAAI,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;YAC3B,OAAO,GAAG,UAAU,GAAG,IAAI,EAAE,CAAC;QAChC,CAAC;QACD,OAAO,GAAG,UAAU,GAAG,IAAA,kBAAU,EAAC,IAAI,CAAC,EAAE,CAAC;IAC5C,CAAC;IAED,IAAI,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QAChC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QAC3B,OAAO,GAAG,UAAU,GAAG,IAAA,kBAAU,EAAC,IAAI,CAAC,EAAE,CAAC;IAC5C,CAAC;IAED,IAAI,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QAC3B,OAAO,GAAG,UAAU,GAAG,IAAI,EAAE,CAAC;IAChC,CAAC;IAED,OAAO,GAAG,UAAU,GAAG,IAAA,kBAAU,EAAC,IAAI,CAAC,EAAE,CAAC;AAC5C,CAAC","sourcesContent":["import type { TSESTree } from '@typescript-eslint/utils';\nimport * as path from 'path';\nimport { createRule } from '../../rule-creator';\nimport { capitalize } from '../../utils';\n\nexport const prefixSelectorsWithSelect = 'prefixSelectorsWithSelect';\nexport const prefixSelectorsWithSelectSuggest =\n  'prefixSelectorsWithSelectSuggest';\n\ntype MessageIds =\n  | typeof prefixSelectorsWithSelect\n  | typeof prefixSelectorsWithSelectSuggest;\ntype Options = readonly [];\n\nexport default createRule<Options, MessageIds>({\n  name: path.parse(__filename).name,\n  meta: {\n    type: 'suggestion',\n    hasSuggestions: true,\n    docs: {\n      description:\n        'The selector should start with \"select\", for example \"selectEntity\".',\n      ngrxModule: 'store',\n    },\n    schema: [],\n    messages: {\n      [prefixSelectorsWithSelect]: 'The selector should start with \"select\".',\n      [prefixSelectorsWithSelectSuggest]:\n        'Prefix the selector with \"select\": `{{ name }}`.',\n    },\n  },\n  defaultOptions: [],\n  create: (context) => {\n    function reportIfInvalid(name: string, node: TSESTree.Identifier) {\n      // Name starts with select and\n      // the first character after select is an uppercase ASCII letter, _, or $\n      const isValid =\n        name.startsWith('select') &&\n        name.length > 'select'.length &&\n        /^[A-Z_$]/.test(name.slice('select'.length));\n\n      if (!isValid) {\n        const suggestedName = getSuggestedName(name);\n        context.report({\n          node,\n          loc: {\n            start: node.loc.start,\n            end: {\n              line: node.loc.start.line,\n              column: node.loc.start.column + name.length,\n            },\n          },\n          messageId: prefixSelectorsWithSelect,\n          suggest: [\n            {\n              messageId: prefixSelectorsWithSelectSuggest,\n              data: { name: suggestedName },\n              fix: (fixer) => {\n                const parent = node.parent;\n                const sourceCode = context.getSourceCode();\n\n                // Handle destructuring: { selectAll: allItems }\n                if (\n                  parent &&\n                  parent.type === 'Property' &&\n                  parent.value === node &&\n                  parent.parent &&\n                  parent.parent.type === 'ObjectPattern'\n                ) {\n                  return fixer.replaceText(node, suggestedName);\n                }\n\n                // Handle simple variable declarator: const allItems = ...\n                if (\n                  parent &&\n                  parent.type === 'VariableDeclarator' &&\n                  parent.id.type === 'Identifier'\n                ) {\n                  const typeAnnotation = parent.id.typeAnnotation\n                    ? sourceCode.getText(parent.id.typeAnnotation)\n                    : '';\n                  return fixer.replaceText(\n                    parent.id,\n                    `${suggestedName}${typeAnnotation}`\n                  );\n                }\n\n                // Fallback: just replace the identifier\n                return fixer.replaceText(node, suggestedName);\n              },\n            },\n          ],\n        });\n      }\n    }\n\n    function isSelectorFactoryCall(node: TSESTree.CallExpression): boolean {\n      const callee = node.callee;\n      return (\n        callee.type === 'Identifier' &&\n        [\n          'createSelector',\n          'createFeatureSelector',\n          'createSelectorFactory',\n        ].includes(callee.name)\n      );\n    }\n\n    function checkFunctionBody(\n      name: string,\n      node: TSESTree.Identifier,\n      body: TSESTree.BlockStatement | TSESTree.Expression\n    ) {\n      if (body.type === 'CallExpression' && isSelectorFactoryCall(body)) {\n        reportIfInvalid(name, node);\n      }\n\n      if (body.type === 'BlockStatement') {\n        for (const stmt of body.body) {\n          if (\n            stmt.type === 'ReturnStatement' &&\n            stmt.argument &&\n            stmt.argument.type === 'CallExpression' &&\n            isSelectorFactoryCall(stmt.argument)\n          ) {\n            reportIfInvalid(name, node);\n          }\n        }\n      }\n    }\n\n    return {\n      VariableDeclarator(node: TSESTree.VariableDeclarator) {\n        const { id, init } = node;\n\n        const isSelectorSource =\n          init?.type === 'CallExpression' &&\n          ((init.callee.type === 'Identifier' &&\n            init.callee.name === 'getSelectors') ||\n            (init.callee.type === 'MemberExpression' &&\n              init.callee.property.type === 'Identifier' &&\n              init.callee.property.name === 'getSelectors'));\n\n        if (id.type === 'ObjectPattern' && isSelectorSource) {\n          for (const prop of id.properties) {\n            if (prop.type === 'Property' && prop.value.type === 'Identifier') {\n              reportIfInvalid(prop.value.name, prop.value);\n            }\n          }\n          return;\n        }\n\n        if (id.type === 'Identifier') {\n          const typeName =\n            node.id.typeAnnotation?.typeAnnotation.type === 'TSTypeReference' &&\n            node.id.typeAnnotation.typeAnnotation.typeName.type === 'Identifier'\n              ? node.id.typeAnnotation.typeAnnotation.typeName.name\n              : null;\n\n          const hasSelectorType =\n            typeName !== null && /Selector$/.test(typeName);\n\n          const isSelectorCall =\n            init?.type === 'CallExpression' && isSelectorFactoryCall(init);\n\n          const isArrowFunction =\n            init?.type === 'ArrowFunctionExpression' &&\n            init.body &&\n            (init.body.type === 'CallExpression' ||\n              init.body.type === 'BlockStatement');\n\n          const isFunctionExpression =\n            init?.type === 'FunctionExpression' &&\n            init.body &&\n            init.body.type === 'BlockStatement';\n\n          if (hasSelectorType || isSelectorCall) {\n            reportIfInvalid(id.name, id);\n          } else if (isArrowFunction || isFunctionExpression) {\n            checkFunctionBody(id.name, id, init.body);\n          }\n        }\n      },\n    };\n  },\n});\n\nfunction getSuggestedName(name: string): string {\n  const selectWord = 'select';\n\n  if (name.startsWith(selectWord)) {\n    const rest = name.slice(selectWord.length);\n    if (rest.length === 0) {\n      return 'selectSelect';\n    }\n    if (/^[A-Z_]+$/.test(rest)) {\n      return `${selectWord}${rest}`;\n    }\n    return `${selectWord}${capitalize(rest)}`;\n  }\n\n  if (/^get([^a-z].+)/.test(name)) {\n    const rest = name.slice(3);\n    return `${selectWord}${capitalize(rest)}`;\n  }\n\n  if (/^[A-Z_]+$/.test(name)) {\n    return `${selectWord}${name}`;\n  }\n\n  return `${selectWord}${capitalize(name)}`;\n}\n"]}