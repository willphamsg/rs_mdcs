{"version":3,"file":"avoid-duplicate-actions-in-reducer.js","sourceRoot":"","sources":["../../../../../../modules/eslint-plugin/src/rules/store/avoid-duplicate-actions-in-reducer.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,2CAA6B;AAC7B,qDAAgD;AAChD,uCAAqE;AAExD,QAAA,8BAA8B,GAAG,gCAAgC,CAAC;AAClE,QAAA,qCAAqC,GAChD,uCAAuC,CAAC;AAQ1C,kBAAe,IAAA,yBAAU,EAAsB;IAC7C,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI;IACjC,IAAI,EAAE;QACJ,IAAI,EAAE,YAAY;QAClB,cAAc,EAAE,IAAI;QACpB,IAAI,EAAE;YACJ,WAAW,EAAE,6CAA6C;YAC1D,UAAU,EAAE,OAAO;SACpB;QACD,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE;YACR,CAAC,sCAA8B,CAAC,EAC9B,gEAAgE;YAClE,CAAC,6CAAqC,CAAC,EAAE,0BAA0B;SACpE;KACF;IACD,cAAc,EAAE,EAAE;IAClB,MAAM,EAAE,CAAC,OAAO,EAAE,EAAE;QAClB,MAAM,gBAAgB,GAAG,IAAI,GAAG,EAAoB,CAAC;QAErD,OAAO;YACL,CAAC,GAAG,qBAAa,oEAAoE,CAAC,CAAC,EACrF,SAAS,EAAE,CAAC,MAAM,CAAC,GAGpB;gBACC,MAAM,OAAO,GAAG,gBAAgB,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;gBACxD,gBAAgB,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,GAAG,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;YAC1D,CAAC;YACD,CAAC,GAAG,qBAAa,OAAO,CAAC;gBACvB,KAAK,MAAM,CAAC,UAAU,EAAE,WAAW,CAAC,IAAI,gBAAgB,EAAE,CAAC;oBACzD,IAAI,WAAW,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC;wBAC5B,MAAM;oBACR,CAAC;oBAED,KAAK,MAAM,IAAI,IAAI,WAAW,EAAE,CAAC;wBAC/B,OAAO,CAAC,MAAM,CAAC;4BACb,IAAI;4BACJ,SAAS,EAAE,sCAA8B;4BACzC,IAAI,EAAE;gCACJ,UAAU;6BACX;4BACD,OAAO,EAAE;gCACP;oCACE,SAAS,EAAE,6CAAqC;oCAChD,GAAG,EAAE,CAAC,KAAK,EAAE,EAAE,CACb,IAAA,+BAAuB,EACrB,OAAO,CAAC,UAAU,EAClB,KAAK,EACL,IAAI,CAAC,MAAM,CACZ;iCACJ;6BACF;yBACF,CAAC,CAAC;oBACL,CAAC;gBACH,CAAC;gBAED,gBAAgB,CAAC,KAAK,EAAE,CAAC;YAC3B,CAAC;SACF,CAAC;IACJ,CAAC;CACF,CAAC,CAAC","sourcesContent":["import type { TSESTree } from '@typescript-eslint/utils';\nimport * as path from 'path';\nimport { createRule } from '../../rule-creator';\nimport { createReducer, getNodeToCommaRemoveFix } from '../../utils';\n\nexport const avoidDuplicateActionsInReducer = 'avoidDuplicateActionsInReducer';\nexport const avoidDuplicateActionsInReducerSuggest =\n  'avoidDuplicateActionsInReducerSuggest';\n\ntype MessageIds =\n  | typeof avoidDuplicateActionsInReducer\n  | typeof avoidDuplicateActionsInReducerSuggest;\ntype Options = readonly [];\ntype Action = TSESTree.Identifier & { parent: TSESTree.CallExpression };\n\nexport default createRule<Options, MessageIds>({\n  name: path.parse(__filename).name,\n  meta: {\n    type: 'suggestion',\n    hasSuggestions: true,\n    docs: {\n      description: 'A `Reducer` should handle an `Action` once.',\n      ngrxModule: 'store',\n    },\n    schema: [],\n    messages: {\n      [avoidDuplicateActionsInReducer]:\n        'The `Reducer` handles a duplicate `Action` `{{ actionName }}`.',\n      [avoidDuplicateActionsInReducerSuggest]: 'Remove this duplication.',\n    },\n  },\n  defaultOptions: [],\n  create: (context) => {\n    const collectedActions = new Map<string, Action[]>();\n\n    return {\n      [`${createReducer} > CallExpression[callee.name='on'][arguments.0.type='Identifier']`]({\n        arguments: [action],\n      }: TSESTree.CallExpression & {\n        arguments: Action[];\n      }) {\n        const actions = collectedActions.get(action.name) ?? [];\n        collectedActions.set(action.name, [...actions, action]);\n      },\n      [`${createReducer}:exit`]() {\n        for (const [actionName, identifiers] of collectedActions) {\n          if (identifiers.length <= 1) {\n            break;\n          }\n\n          for (const node of identifiers) {\n            context.report({\n              node,\n              messageId: avoidDuplicateActionsInReducer,\n              data: {\n                actionName,\n              },\n              suggest: [\n                {\n                  messageId: avoidDuplicateActionsInReducerSuggest,\n                  fix: (fixer) =>\n                    getNodeToCommaRemoveFix(\n                      context.sourceCode,\n                      fixer,\n                      node.parent\n                    ),\n                },\n              ],\n            });\n          }\n        }\n\n        collectedActions.clear();\n      },\n    };\n  },\n});\n"]}