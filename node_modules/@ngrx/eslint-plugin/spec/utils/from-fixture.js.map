{"version":3,"file":"from-fixture.js","sourceRoot":"","sources":["../../../../../modules/eslint-plugin/spec/utils/from-fixture.ts"],"names":[],"mappings":";;AAuBA,kCAiBC;AAjBD,SAAgB,WAAW,CAIzB,OAAe,EACf,kBAKI,EAAE;IAEN,MAAM,EAAE,WAAW,EAAE,GAAG,IAAI,EAAE,GAAG,eAAe,CAAC;IACjD,OAAO;QACL,GAAG,IAAI;QACP,GAAG,YAAY,CAAC,OAAO,EAAE,WAAW,CAAC;KACtC,CAAC;AACJ,CAAC;AAED,SAAS,cAAc,CACrB,WAGa,EACb,OAAgB,EAChB,OAA2B;IAE3B,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO,EAAE,CAAC;QAC7B,OAAO,EAAE,CAAC;IACZ,CAAC;IACD,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,EAAE,WAAW,EAAW,CAAC;IAClC,CAAC;IACD,OAAO;QACL,WAAW,EAAE,OAAO;aACjB,KAAK,CAAC,KAAK,CAAC;aACZ,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC;KAClD,CAAC;AACb,CAAC;AAED,SAAS,YAAY,CACnB,OAAe,EACf,WAAoE;IAEpE,MAAM,WAAW,GACf,kHAAkH,CAAC;IACrH,MAAM,KAAK,GAAa,EAAE,CAAC;IAC3B,MAAM,MAAM,GAAwC,EAAE,CAAC;IACvD,IAAI,YAAY,GAAG,KAAK,CAAC;IACzB,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;QACnC,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;QACtC,IAAI,KAAK,EAAE,MAAM,EAAE,CAAC;YAClB,MAAM,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;YAC9C,MAAM,SAAS,GAAG,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACrD,MAAM,EAAE,MAAM,EAAE,GAAG,KAAK,CAAC;YACzB,MAAM,CAAC,IAAI,CAAC;gBACV,MAAM;gBACN,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC;gBAC3C,SAAS;gBACT,OAAO,EAAE,MAAM;gBACf,IAAI,EAAE,MAAM;gBACZ,SAAS,EAAE,KAAK,CAAC,MAAM,CAAC,EAAiB;gBACzC,kHAAkH;gBAClH,GAAI,cAAc,CAChB,WAAW,EACX,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,EAC7B,KAAK,CAAC,MAAM,CAAC,OAAO,EAAE,IAAI,EAAE,CACwB;aACvD,CAAC,CAAC;YACH,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACzB,YAAY,GAAG,IAAI,CAAC;YACtB,CAAC;QACH,CAAC;aAAM,CAAC;YACN,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACnB,CAAC;IACH,CAAC,CAAC,CAAC;IACH,IAAI,WAAW,IAAI,CAAC,YAAY,EAAE,CAAC;QACjC,MAAM,IAAI,KAAK,CAAC,0DAA0D,CAAC,CAAC;IAC9E,CAAC;IACD,OAAO;QACL,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;QACtB,MAAM;KACP,CAAC;AACJ,CAAC","sourcesContent":["import { TSESLint as eslint } from '@typescript-eslint/utils';\n\nexport function fromFixture<TMessageIds extends string>(\n  fixture: string,\n  invalidTestCase?: {\n    output?: string;\n    suggestions?: readonly eslint.SuggestionOutput<TMessageIds>[] | null;\n  }\n): eslint.InvalidTestCase<TMessageIds, never>;\n\nexport function fromFixture<\n  TMessageIds extends string,\n  TOptions extends readonly unknown[],\n>(\n  fixture: string,\n  invalidTestCase: Omit<\n    eslint.InvalidTestCase<TMessageIds, TOptions>,\n    'code' | 'errors'\n  > & {\n    suggestions?: readonly eslint.SuggestionOutput<TMessageIds>[] | null;\n  }\n): eslint.InvalidTestCase<TMessageIds, TOptions>;\n\nexport function fromFixture<\n  TMessageIds extends string,\n  TOptions extends readonly unknown[],\n>(\n  fixture: string,\n  invalidTestCase: Omit<\n    eslint.InvalidTestCase<TMessageIds, TOptions>,\n    'code' | 'errors'\n  > & {\n    suggestions?: readonly eslint.SuggestionOutput<TMessageIds>[] | null;\n  } = {}\n): eslint.InvalidTestCase<TMessageIds, TOptions> {\n  const { suggestions, ...rest } = invalidTestCase;\n  return {\n    ...rest,\n    ...parseFixture(fixture, suggestions),\n  };\n}\n\nfunction getSuggestions<TMessageIds extends string>(\n  suggestions:\n    | readonly eslint.SuggestionOutput<TMessageIds>[]\n    | null\n    | undefined,\n  suggest: boolean,\n  indices: string | undefined\n) {\n  if (!suggestions || !suggest) {\n    return {};\n  }\n  if (!indices) {\n    return { suggestions } as const;\n  }\n  return {\n    suggestions: indices\n      .split(/\\s+/)\n      .map((index) => suggestions[Number.parseInt(index, 10)]),\n  } as const;\n}\n\nfunction parseFixture<TMessageIds extends string>(\n  fixture: string,\n  suggestions?: readonly eslint.SuggestionOutput<TMessageIds>[] | null\n) {\n  const errorRegExp =\n    /^(?<indent>\\s*)(?<error>~+)\\s*\\[(?<id>\\w+)\\s*(?<data>.*?)(?:\\s*(?<suggest>suggest)\\s*(?<indices>[\\d\\s]*))?\\]\\s*$/;\n  const lines: string[] = [];\n  const errors: eslint.TestCaseError<TMessageIds>[] = [];\n  let suggestFound = false;\n  fixture.split('\\n').forEach((line) => {\n    const match = line.match(errorRegExp);\n    if (match?.groups) {\n      const column = match.groups.indent.length + 1;\n      const endColumn = column + match.groups.error.length;\n      const { length } = lines;\n      errors.push({\n        column,\n        data: JSON.parse(match.groups.data || '{}'),\n        endColumn,\n        endLine: length,\n        line: length,\n        messageId: match.groups.id as TMessageIds,\n        // TODO: Remove type assertion once https://github.com/typescript-eslint/typescript-eslint/pull/3844 is available.\n        ...(getSuggestions(\n          suggestions,\n          Boolean(match.groups.suggest),\n          match.groups.indices?.trim()\n        ) as eslint.TestCaseError<TMessageIds>['suggestions']),\n      });\n      if (match.groups.suggest) {\n        suggestFound = true;\n      }\n    } else {\n      lines.push(line);\n    }\n  });\n  if (suggestions && !suggestFound) {\n    throw new Error(\"Suggestions specified but no 'suggest' annotation found.\");\n  }\n  return {\n    code: lines.join('\\n'),\n    errors,\n  };\n}\n"]}