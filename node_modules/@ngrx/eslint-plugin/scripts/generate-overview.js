"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const os_1 = require("os");
const prettier_1 = require("prettier");
const rules_1 = require("../src/utils/helper-functions/rules");
(async () => {
    const prettierConfig = await (0, prettier_1.resolveConfig)(__dirname);
    const OVERVIEW = './projects/ngrx.io/content/guide/eslint-plugin/index.md';
    const GH_CONFIGS = 'https://github.com/ngrx/platform/blob/main/modules/eslint-plugin/src/configs';
    await generateRules();
    await generateConfigurations();
    async function generateRules() {
        const moduleRules = Object.entries(rules_1.rulesForGenerate).reduce((all, [ruleName, { meta }]) => {
            if (!meta.docs) {
                throw new Error(`Rule ${ruleName} is missing meta.docs information`);
            }
            all[meta.docs.ngrxModule] = (all[meta.docs.ngrxModule] ?? []).concat([
                [
                    `[@ngrx/${ruleName}]${meta.docs?.url
                        ? '(' +
                            meta.docs.url
                                .replace('https://ngrx.io', '')
                                .replace('.md', '') +
                            ')'
                        : ''}`,
                    meta.docs?.description ?? 'TODO',
                    meta.type,
                    meta.fixable ? 'Yes' : 'No',
                    meta.hasSuggestions ? 'Yes' : 'No',
                    Array.isArray(meta.schema) && meta.schema.length ? 'Yes' : 'No',
                    meta.docs?.requiresTypeChecking ? 'Yes' : 'No',
                ],
            ]);
            return all;
        }, {});
        const tableHeader = `| Name | Description | Category | Fixable | Has suggestions | Configurable | Requires type information
| --- | --- | --- | --- | --- | --- | --- |`;
        const configTable = Object.entries(moduleRules).map(([ngrxModule, pluginRules]) => {
            const tableBody = pluginRules
                .map((rule) => `|${rule.join('|')}|`)
                .join(os_1.EOL);
            const table = [tableHeader, tableBody].join(os_1.EOL);
            return [`### ${ngrxModule}`, table].join(os_1.EOL);
        });
        const overview = (0, fs_1.readFileSync)(OVERVIEW, 'utf-8');
        const start = overview.indexOf('<!-- RULES-CONFIG:START -->');
        const end = overview.indexOf('<!-- RULES-CONFIG:END -->');
        const newOverview = await (0, prettier_1.format)(`${overview.substring(0, start + '<!-- RULES-CONFIG:START -->'.length)}
${configTable.join(os_1.EOL)}
${overview.substring(end)}`, {
            ...prettierConfig,
            parser: 'markdown',
        });
        (0, fs_1.writeFileSync)(OVERVIEW, newOverview);
    }
    async function generateConfigurations() {
        const tableHeader = `| Name |
    | --- |`;
        const overview = (0, fs_1.readFileSync)(OVERVIEW, 'utf-8');
        const start = overview.indexOf('<!-- CONFIGURATIONS-CONFIG:START -->');
        const end = overview.indexOf('<!-- CONFIGURATIONS-CONFIG:END -->');
        const configTable = rules_1.configsForGenerate.map((configName) => `| [${configName}](${GH_CONFIGS}/${configName}.json) |`);
        const newOverview = await (0, prettier_1.format)(`${overview.substring(0, start + '<!-- CONFIGURATIONS-CONFIG:START -->'.length)}
${[tableHeader, ...configTable].join(os_1.EOL)}
${overview.substring(end)}`, {
            ...prettierConfig,
            parser: 'markdown',
        });
        (0, fs_1.writeFileSync)(OVERVIEW, newOverview);
    }
})();
//# sourceMappingURL=generate-overview.js.map